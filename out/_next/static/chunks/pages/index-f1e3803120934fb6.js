(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(7625)}])},4661:function(e,n,t){"use strict";t.d(n,{hd:function(){return getPaddedMonth},kC:function(){return capitalize},v4:function(){return isInViewport}});let getPaddedMonth=e=>e<10?"0".concat(e):e,capitalize=e=>e.charAt(0).toUpperCase()+e.slice(1),isInViewport=e=>{let n=e.getBoundingClientRect();return n.top>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)}},7625:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return GameReport}});var i=t(5893),a=t(8951),o=t(8583),r=t(9983),l=t(6167),s=t(5103);let c=(0,s.cn)(void 0),d=(0,s.cn)(new l.qQ),h=(0,s.cn)(new l.qQ),u=(0,s.cn)({}),m=(0,s.cn)(!0),v=(0,s.cn)(!0),g=(0,s.cn)(!0),x=(0,s.cn)(r.g_.Stockfish16),p=(0,s.cn)(16),j=(0,s.cn)(3),f=(0,s.cn)(0),y=(0,s.cn)({});var w=t(7294),Z=t(7853),C=t(7279),b=t(7697);let usePlayersNames=e=>{var n,t,i,a;let r=(0,o.Dv)(e),{gameFromUrl:l}=(0,b.f)(),s=(null==l?void 0:null===(n=l.white)||void 0===n?void 0:n.name)||r.header().White||"White",c=(null==l?void 0:null===(t=l.black)||void 0===t?void 0:t.name)||r.header().Black||"Black",d=(null==l?void 0:null===(i=l.white)||void 0===i?void 0:i.rating)||r.header().WhiteElo||void 0,h=(null==l?void 0:null===(a=l.black)||void 0===a?void 0:a.rating)||r.header().BlackElo||void 0;return{whiteName:s,blackName:c,whiteElo:d,blackElo:h}};function BoardContainer(){let e=(0,Z.e)(),n=(0,o.Dv)(m),t=(0,o.Dv)(v),{whiteName:a,whiteElo:l,blackName:s,blackElo:c}=usePlayersNames(d),x=(0,w.useMemo)(()=>{var n;let t=e.width,i=e.height;return(null===(n=window)||void 0===n?void 0:n.innerWidth)<1200?Math.min(t,i-150):Math.min(t-700,.95*i)},[e]);return(0,i.jsx)(C.Z,{id:"AnalysisBoard",boardSize:x,canPlay:!0,gameAtom:h,whitePlayer:l?"".concat(a," (").concat(l,")"):a,blackPlayer:c?"".concat(s," (").concat(c,")"):s,boardOrientation:n?r.Il.White:r.Il.Black,currentPositionAtom:u,showBestMoveArrow:t,showPlayerMoveIconAtom:g,showEvaluationBar:!0})}var P=t(1954),k=t(6886),I=t(5861),E=t(8462),D=t(7212),B=t(8078),S=t(5366);function LineEvaluation(e){let{line:n}=e,t=(0,o.Dv)(h),a=void 0!==n.cp?"".concat(n.cp/100):n.mate?"".concat(n.mate>0?"":"-","M").concat(Math.abs(n.mate)):"?",r=n.depth<6;return(0,i.jsxs)(D.ZP,{disablePadding:!0,children:[(0,i.jsx)(I.Z,{marginRight:1.5,marginY:.5,noWrap:!0,overflow:"visible",width:"3em",textAlign:"center",fontSize:"0.9rem",children:r?(0,i.jsx)(B.Z,{variant:"rounded",animation:"wave",sx:{color:"transparent"},children:"placeholder"}):a}),(0,i.jsx)(I.Z,{noWrap:!0,maxWidth:{xs:"15em",sm:"25em",md:"30em",lg:"25em"},fontSize:"0.9rem",children:r?(0,i.jsx)(B.Z,{variant:"rounded",animation:"wave",width:"15em"}):n.pv.map((0,S.Rr)(t.fen())).join(", ")})]})}var G=t(9758),R=t(328);let useCurrentPosition=e=>{let[n,t]=(0,o.KO)(u),i=(0,G.E)(e),a=(0,o.Dv)(c),r=(0,o.Dv)(d),l=(0,o.Dv)(h),s=(0,o.Dv)(p),m=(0,o.Dv)(j),[v,g]=(0,o.KO)(y);return(0,w.useEffect)(()=>{let n={lastMove:l.history({verbose:!0}).at(-1)},o=l.history(),c=r.history();if(o.length<=c.length&&c.slice(0,o.length).join()===o.join()&&(n.currentMoveIdx=o.length,a)){let e=o.length;n.eval=a.positions[e],n.lastEval=e>0?a.positions[e-1]:void 0}if(t(n),!n.eval&&(null==i?void 0:i.isReady())&&e){let getFenEngineEval=async(n,t)=>{if(!(null==i?void 0:i.isReady())||!e)throw Error("Engine not ready");let a=v[n];if(a&&a.engine===e&&a.lines[0].depth>=s)return null==t||t(a),a;let o=await i.evaluatePositionWithUpdate({fen:n,depth:s,multiPv:m,setPartialEval:t});return g(t=>({...t,[n]:{...o,engine:e}})),o},getPositionEval=async()=>{let e=await getFenEngineEval(l.fen(),e=>{t({...n,eval:e})});if(0===o.length)return;let i=(0,S.Bn)(l),a=i.fens.slice("w"===l.turn()?-3:-4),r=i.uciMoves.slice("w"===l.turn()?-2:-3),s=await getFenEngineEval(a.slice(-2)[0]),c=a.map((n,t)=>t===a.length-2?s:t===a.length-1?e:{lines:[{pv:[],depth:0,multiPv:1,cp:1}]}),d=(0,R.W)(c,r,a);t({...n,eval:d.slice(-1)[0],lastEval:d.slice(-2)[0]})};getPositionEval()}return()=>{null==i||i.stopSearch()}},[a,l,r,i,s,m]),n};var M=t(4386),W=t(3946),J=t(7539),L=t(657),A=t(7645),z=t(6514),_=t(4054),O=t(3841),T=t(5945),H=t(7709),Y=t(8972),N=t(1425),F=t(5662),X=t(6836),K=t(9368),U=t(2939);function ArrowOptions(){let[e,n]=(0,U.Y)("show-arrow-best-move",v),[t,a]=(0,U.Y)("show-icon-player-move",g);return(0,i.jsxs)(k.ZP,{container:!0,item:!0,justifyContent:"space-evenly",alignItems:"center",xs:12,gap:3,children:[(0,i.jsx)(X.Z,{control:(0,i.jsx)(K.Z,{checked:e,onChange:(e,t)=>n(t)}),label:"Show engine best move arrow",sx:{marginX:0}}),(0,i.jsx)(X.Z,{control:(0,i.jsx)(K.Z,{checked:t,onChange:(e,n)=>a(n)}),label:"Show played move icon",sx:{marginX:0}})]})}var q=t(9232);function EngineSettingsDialog(e){let{open:n,onClose:t}=e,[a,o]=(0,U.Y)("engine-depth",p),[l,s]=(0,U.Y)("engine-multi-pv",j),[c,d]=(0,U.Y)("engine-name",x);return(0,w.useEffect)(()=>{q.E.isSupported()||d(r.g_.Stockfish11)},[d]),(0,i.jsxs)(L.Z,{open:n,onClose:t,maxWidth:"md",fullWidth:!0,children:[(0,i.jsx)(A.Z,{marginY:1,variant:"h5",children:"Set engine parameters"}),(0,i.jsxs)(z.Z,{sx:{paddingBottom:0},children:[(0,i.jsx)(I.Z,{children:"Stockfish 16 Lite (HCE) is the default engine. It offers the best balance between speed and strength. Stockfish 16 is the strongest engine available, but please note that it requires a one time download of 40MB."}),(0,i.jsxs)(k.ZP,{marginTop:4,item:!0,container:!0,justifyContent:"center",alignItems:"center",xs:12,rowGap:3,children:[(0,i.jsx)(k.ZP,{item:!0,container:!0,xs:12,justifyContent:"center",children:(0,i.jsxs)(_.Z,{variant:"outlined",children:[(0,i.jsx)(O.Z,{id:"dialog-select-label",children:"Engine"}),(0,i.jsx)(T.Z,{labelId:"dialog-select-label",id:"dialog-select",displayEmpty:!0,input:(0,i.jsx)(H.Z,{label:"Engine"}),value:c,onChange:e=>d(e.target.value),sx:{width:280,maxWidth:"100%"},children:Object.values(r.g_).map(e=>(0,i.jsx)(Y.Z,{value:e,disabled:!!e.includes("stockfish_16")&&!q.E.isSupported(),children:V[e]},e))})]})}),(0,i.jsx)(J.Z,{label:"Maximum depth",value:a,setValue:o,min:10,max:30,marksFilter:2}),(0,i.jsx)(J.Z,{label:"Number of lines",value:l,setValue:s,min:2,max:6,xs:6}),(0,i.jsx)(ArrowOptions,{})]})]}),(0,i.jsx)(N.Z,{sx:{m:2},children:(0,i.jsx)(F.Z,{variant:"contained",onClick:t,children:"Done"})})]})}let V={[r.g_.Stockfish16]:"Stockfish 16 Lite (HCE)",[r.g_.Stockfish16NNUE]:"Stockfish 16 (40MB download)",[r.g_.Stockfish11]:"Stockfish 11"};function EngineSettingsButton(){let[e,n]=(0,w.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(M.Z,{title:"Engine settings",children:(0,i.jsx)(W.Z,{onClick:()=>n(!0),sx:{paddingY:.3},children:(0,i.jsx)(P.JO,{icon:"ri:settings-3-line",height:20})})}),(0,i.jsx)(EngineSettingsDialog,{open:e,onClose:()=>n(!1)})]})}function Accuracies(){let e=(0,o.Dv)(c);return e?(0,i.jsxs)(k.ZP,{item:!0,container:!0,xs:12,justifyContent:"center",alignItems:"center",columnGap:{xs:"8vw",md:10},children:[(0,i.jsx)(I.Z,{align:"center",sx:{backgroundColor:"white",color:"black"},borderRadius:"5px",lineHeight:1,padding:1,fontWeight:"bold",border:"1px solid #424242",children:"".concat(null==e?void 0:e.accuracy.white.toFixed(1)," %")}),(0,i.jsx)(I.Z,{align:"center",children:"Accuracies"}),(0,i.jsx)(I.Z,{align:"center",sx:{backgroundColor:"black",color:"white"},borderRadius:"5px",lineHeight:1,padding:1,fontWeight:"bold",border:"1px solid #424242",children:"".concat(null==e?void 0:e.accuracy.black.toFixed(1)," %")})]}):null}function MoveInfo(){var e,n,t;let a=(0,o.Dv)(u),l=(0,o.Dv)(h),s=null==a?void 0:null===(e=a.lastEval)||void 0===e?void 0:e.bestMove,c=(0,w.useMemo)(()=>{var e;if(!s)return;let n=null===(e=l.history({verbose:!0}).at(-1))||void 0===e?void 0:e.before;if(n)return(0,S.Rr)(n)(s)},[s,l]);if(!c)return null;let d=null===(n=a.eval)||void 0===n?void 0:n.moveClassification,m=d?"".concat(null===(t=a.lastMove)||void 0===t?void 0:t.san," is ").concat(Q[d]):null,v=d===r.ZJ.Best||d===r.ZJ.Book||d===r.ZJ.Brilliant||d===r.ZJ.Great?null:"".concat(c," was the best move");return(0,i.jsxs)(k.ZP,{item:!0,container:!0,columnGap:5,xs:12,justifyContent:"center",children:[m&&(0,i.jsx)(I.Z,{align:"center",fontSize:"0.9rem",children:m}),v&&(0,i.jsx)(I.Z,{align:"center",fontSize:"0.9rem",children:v})]})}let Q={[r.ZJ.Book]:"a book move",[r.ZJ.Brilliant]:"brilliant !!",[r.ZJ.Great]:"a great move !",[r.ZJ.Best]:"the best move",[r.ZJ.Excellent]:"excellent",[r.ZJ.Good]:"good",[r.ZJ.Inaccuracy]:"an inaccuracy",[r.ZJ.Mistake]:"a mistake",[r.ZJ.Blunder]:"a blunder"};function Opening(){var e;let n=useCurrentPosition(),t=null==n?void 0:null===(e=n.eval)||void 0===e?void 0:e.opening;return t?(0,i.jsx)(k.ZP,{item:!0,xs:12,children:(0,i.jsx)(I.Z,{align:"center",fontSize:"0.9rem",children:t})}):null}function ReviewPanelBody(){var e,n;let t=(0,o.Dv)(j),a=(0,o.Dv)(x),r=useCurrentPosition(a),l=(0,o.Dv)(d),s=(0,o.Dv)(h),c=s.history(),u=l.history(),m=c.length>0&&(s.isCheckmate()||s.isDraw()||c.join()===u.join()),v=Array.from({length:t}).map((e,n)=>({pv:["".concat(n)],depth:0,multiPv:n+1})),g=(null==r?void 0:null===(n=r.eval)||void 0===n?void 0:null===(e=n.lines)||void 0===e?void 0:e.length)?r.eval.lines:v;return(0,i.jsxs)(k.ZP,{item:!0,container:!0,xs:12,justifyContent:"center",alignItems:"center",rowGap:1.2,children:[(0,i.jsxs)(k.ZP,{item:!0,container:!0,xs:12,justifyContent:"space-between",alignItems:"center",children:[(0,i.jsx)(k.ZP,{item:!0,xs:1}),(0,i.jsxs)(k.ZP,{item:!0,container:!0,xs:!0,justifyContent:"center",alignItems:"center",columnGap:1,children:[(0,i.jsx)(P.JO,{icon:"pepicons-pop:star-filled-circle",color:"#27f019",height:25}),(0,i.jsx)(I.Z,{variant:"h6",align:"center",lineHeight:"25px",children:"Engine evaluation"})]}),(0,i.jsx)(k.ZP,{item:!0,container:!0,xs:1,justifyContent:"center",children:(0,i.jsx)(EngineSettingsButton,{})})]}),(0,i.jsx)(Accuracies,{}),(0,i.jsx)(MoveInfo,{}),(0,i.jsx)(Opening,{}),m&&(0,i.jsx)(k.ZP,{item:!0,xs:12,children:(0,i.jsx)(I.Z,{align:"center",fontSize:"0.9rem",children:"Game is over"})}),(0,i.jsx)(k.ZP,{item:!0,container:!0,xs:12,justifyContent:"center",alignItems:"center",children:(0,i.jsx)(E.Z,{sx:{maxWidth:"95%",padding:0},children:!s.isCheckmate()&&g.map(e=>(0,i.jsx)(LineEvaluation,{line:e},e.multiPv))})})]})}function GamePanel(){let{gameFromUrl:e}=(0,b.f)(),n=(0,o.Dv)(d),t=void 0!==e||!!n.header().White;return t?(0,i.jsxs)(k.ZP,{item:!0,container:!0,xs:11,justifyContent:"space-evenly",alignItems:"center",rowGap:1,columnGap:3,children:[(0,i.jsx)(k.ZP,{item:!0,container:!0,xs:!0,justifyContent:"center",alignItems:"center",children:(0,i.jsxs)(I.Z,{noWrap:!0,fontSize:"0.9rem",children:["Site : ",(null==e?void 0:e.site)||n.header().Site||"?"]})}),(0,i.jsx)(k.ZP,{item:!0,container:!0,xs:!0,justifyContent:"center",alignItems:"center",children:(0,i.jsxs)(I.Z,{noWrap:!0,fontSize:"0.9rem",children:["Date : ",(null==e?void 0:e.date)||n.header().Date||"?"]})}),(0,i.jsx)(k.ZP,{item:!0,container:!0,xs:!0,justifyContent:"center",alignItems:"center",children:(0,i.jsxs)(I.Z,{noWrap:!0,fontSize:"0.9rem",children:["Result :"," ",(null==e?void 0:e.termination)||n.header().Termination||"?"]})})]}):null}var $=t(1873),ee=t(1163);function LoadGame(){let e=(0,ee.useRouter)(),n=(0,o.Dv)(d),{setPgn:t}=(0,a.f)(d),{reset:r}=(0,a.f)(h),{gameFromUrl:s}=(0,b.f)(),u=(0,o.b9)(c),v=(0,o.b9)(m),g=(0,o.Dv)(f),x=(0,w.useCallback)(e=>{r({fen:(0,S.rP)({pgn:e})}),u(void 0),v(!0),t(e)},[r,t,u,v]);(0,w.useEffect)(()=>{let loadGame=async()=>{if(!s)return;let e=new l.qQ;e.loadPgn(s.pgn),n.history().join()!==e.history().join()&&(x(s.pgn),u(s.eval))};loadGame()},[s,n,x,u]);let p=void 0!==s||!!n.header().White;return g?null:(0,i.jsx)($.Z,{label:p?"Load another game":"Load game",size:"small",setGame:async n=>{await e.push("/"),x(n.pgn())}})}var en=t(1812);function AnalyzeButton(){let e=(0,o.Dv)(x),n=(0,G.E)(e),[t,a]=(0,o.KO)(f),r=(0,o.Dv)(p),l=(0,o.Dv)(j),{setGameEval:s,gameFromUrl:h}=(0,b.f)(),[u,m]=(0,o.KO)(c),v=(0,o.Dv)(d),g=(0,o.b9)(y),w=(null==n?void 0:n.isReady())&&v.history().length>0&&!t,handleAnalyze=async()=>{let i=(0,S.Bn)(v);if(!(null==n?void 0:n.isReady())||0===i.fens.length||t)return;let o=await n.evaluateGame({...i,depth:r,multiPv:l,setEvaluationProgress:a});m(o),a(0),h&&s(h.id,o);let c=i.fens.reduce((n,t,i)=>(n[t]={...o.positions[i],engine:e},n),{});g(e=>({...e,...c}))};return t?null:(0,i.jsx)(en.Z,{variant:"contained",size:"small",startIcon:(0,i.jsx)(P.JO,{icon:"streamline:magnifying-glass-solid"}),onClick:handleAnalyze,disabled:!w,children:u?"Analyze again":"Analyze"})}var et=t(8441),ei=t(8962),components_LinearProgressBar=e=>0===e.value?null:(0,i.jsxs)(k.ZP,{item:!0,container:!0,alignItems:"center",justifyContent:"center",xs:12,children:[(0,i.jsx)(I.Z,{variant:"caption",align:"center",children:e.label}),(0,i.jsxs)(k.ZP,{item:!0,container:!0,xs:12,width:"90%",alignItems:"center",justifyContent:"center",wrap:"nowrap",columnGap:2,children:[(0,i.jsx)(k.ZP,{item:!0,sx:{width:"100%"},children:(0,i.jsx)(et.Z,{variant:"determinate",...e,sx:e=>({borderRadius:"5px",height:"5px",["&.".concat(ei.Z.colorPrimary)]:{backgroundColor:e.palette.grey["light"===e.palette.mode?200:700]},["& .".concat(ei.Z.bar)]:{borderRadius:5,backgroundColor:"#308fe8"}})})}),(0,i.jsx)(k.ZP,{item:!0,children:(0,i.jsx)(I.Z,{variant:"body2",color:"text.secondary",children:"".concat(Math.round(e.value),"%")})})]})]});function ReviewPanelHeader(){let e=(0,o.Dv)(f);return(0,i.jsxs)(k.ZP,{item:!0,container:!0,justifyContent:"center",alignItems:"center",xs:12,rowGap:2,children:[(0,i.jsxs)(k.ZP,{item:!0,container:!0,xs:12,justifyContent:"center",alignItems:"center",columnGap:1,children:[(0,i.jsx)(P.JO,{icon:"streamline:clipboard-check",height:24}),(0,i.jsx)(I.Z,{variant:"h5",align:"center",children:"Game Analysis"})]}),(0,i.jsxs)(k.ZP,{item:!0,container:!0,xs:12,justifyContent:"center",alignItems:"center",rowGap:2,columnGap:12,children:[(0,i.jsx)(GamePanel,{}),(0,i.jsx)(LoadGame,{}),(0,i.jsx)(AnalyzeButton,{}),(0,i.jsx)(components_LinearProgressBar,{value:e,label:"Analyzing..."})]})]})}function FlipBoardButton(){let e=(0,o.b9)(m);return(0,i.jsx)(M.Z,{title:"Flip board",children:(0,i.jsx)(W.Z,{onClick:()=>e(e=>!e),sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(P.JO,{icon:"eva:flip-fill"})})})}function NextMoveButton(){let{makeMove:e}=(0,a.f)(h),n=(0,o.Dv)(d),t=(0,o.Dv)(h),r=n.history(),l=t.history(),s=l.length<r.length&&r.slice(0,l.length).join()===l.join(),c=(0,w.useCallback)(()=>{if(!s)return;let t=l.length,i=n.history({verbose:!0})[t];i&&e({from:i.from,to:i.to,promotion:i.promotion})},[s,l,n,e]);return(0,w.useEffect)(()=>{let onKeyDown=e=>{"ArrowRight"===e.key&&c()};return window.addEventListener("keydown",onKeyDown),()=>{window.removeEventListener("keydown",onKeyDown)}},[c]),(0,i.jsx)(M.Z,{title:"Go to next move",children:(0,i.jsx)(k.ZP,{children:(0,i.jsx)(W.Z,{onClick:()=>c(),disabled:!s,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(P.JO,{icon:"ri:arrow-right-s-line",height:30})})})})}function GoToLastPositionButton(){let{setPgn:e}=(0,a.f)(h),n=(0,o.Dv)(d),t=(0,o.Dv)(h),r=n.history(),l=t.history(),s=l>=r;return(0,w.useEffect)(()=>{let onKeyDown=t=>{"ArrowUp"!==t.key||s||e(n.pgn())};return window.addEventListener("keydown",onKeyDown),()=>{window.removeEventListener("keydown",onKeyDown)}},[s,e,n]),(0,i.jsx)(M.Z,{title:"Go to final position",children:(0,i.jsx)(k.ZP,{children:(0,i.jsx)(W.Z,{onClick:()=>{s||e(n.pgn())},disabled:s,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(P.JO,{icon:"ri:skip-forward-line"})})})})}function SaveButton(){let e=(0,o.Dv)(d),n=(0,o.Dv)(h),t=(0,o.Dv)(c),{addGame:a,setGameEval:r,gameFromUrl:l}=(0,b.f)(),s=(0,ee.useRouter)(),u=!l&&(n.history().length||e.history().length),handleSave=async()=>{if(!u)return;let i=(0,S.GC)(e,n),o=await a(i);t&&await r(o,t),s.replace({query:{gameId:o},pathname:s.pathname},void 0,{shallow:!0,scroll:!1})};return(0,i.jsx)(i.Fragment,{children:l?(0,i.jsx)(M.Z,{title:"Game saved in database",children:(0,i.jsx)(k.ZP,{children:(0,i.jsx)(W.Z,{disabled:!0,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(P.JO,{icon:"ri:folder-check-line"})})})}):(0,i.jsx)(M.Z,{title:"Save game",children:(0,i.jsx)(k.ZP,{children:(0,i.jsx)(W.Z,{onClick:handleSave,disabled:!u,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(P.JO,{icon:"ri:save-3-line"})})})})})}function ReviewPanelToolBar(){let e=(0,o.Dv)(h),{reset:n,undoMove:t}=(0,a.f)(h),r=e.history();return(0,w.useEffect)(()=>{let onKeyDown=i=>{0!==r.length&&("ArrowLeft"===i.key?t():"ArrowDown"===i.key&&n({fen:(0,S.rP)({game:e})}))};return window.addEventListener("keydown",onKeyDown),()=>{window.removeEventListener("keydown",onKeyDown)}},[t,r,n,e]),(0,i.jsxs)(k.ZP,{container:!0,item:!0,justifyContent:"center",alignItems:"center",xs:12,children:[(0,i.jsx)(FlipBoardButton,{}),(0,i.jsx)(M.Z,{title:"Reset board",children:(0,i.jsx)(k.ZP,{children:(0,i.jsx)(W.Z,{onClick:()=>n({fen:(0,S.rP)({game:e})}),disabled:0===r.length,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(P.JO,{icon:"ri:skip-back-line"})})})}),(0,i.jsx)(M.Z,{title:"Go to previous move",children:(0,i.jsx)(k.ZP,{children:(0,i.jsx)(W.Z,{onClick:()=>t(),disabled:0===r.length,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(P.JO,{icon:"ri:arrow-left-s-line",height:30})})})}),(0,i.jsx)(NextMoveButton,{}),(0,i.jsx)(GoToLastPositionButton,{}),(0,i.jsx)(SaveButton,{})]})}var ea=t(2734),eo=t(1730),er=t(7720),el=t(5056),es=t(5675),ec=t.n(es),ed=t(4661);function MoveItem(e){let{san:n,moveClassification:t,moveIdx:r}=e,l=(0,o.Dv)(d),{goToMove:s}=(0,a.f)(h),c=(0,o.Dv)(u),m=getMoveColor(t),v=(null==c?void 0:c.currentMoveIdx)===r;return(0,w.useEffect)(()=>{if(!v)return;let e=document.getElementById("move-".concat(r));if(!e)return;let n=document.getElementById("moves-panel");n&&(0,ed.v4)(n)&&e.scrollIntoView({behavior:"smooth",block:"center"})},[v,r]),(0,i.jsxs)(k.ZP,{item:!0,container:!0,justifyContent:"center",alignItems:"center",gap:1,width:"5rem",wrap:"nowrap",onClick:()=>{v||s(r,l)},paddingY:.6,sx:e=>({cursor:v?void 0:"pointer",backgroundColor:v&&"dark"===e.palette.mode?"#4f4f4f":void 0,border:v&&"light"===e.palette.mode?"1px solid #424242":void 0,borderRadius:1}),id:"move-".concat(r),children:[m&&(0,i.jsx)(ec(),{src:"/icons/".concat(t,".png"),alt:"move-icon",width:14,height:14,style:{maxWidth:"3.5vw",maxHeight:"3.5vw"}}),(0,i.jsx)(I.Z,{color:getMoveColor(t),fontSize:"0.9rem",lineHeight:"0.9rem",children:n})]})}let getMoveColor=e=>{if(!(!e||eh.includes(e)))return el.h[e]},eh=[r.ZJ.Good,r.ZJ.Excellent];function MovesLine(e){let{moves:n,moveNb:t}=e;return(0,i.jsxs)(k.ZP,{container:!0,item:!0,justifyContent:"space-evenly",alignItems:"center",xs:12,wrap:"nowrap",children:[(0,i.jsxs)(I.Z,{width:"2rem",fontSize:"0.9rem",children:[t,"."]}),(0,i.jsx)(MoveItem,{...n[0],moveIdx:(t-1)*2+1}),(0,i.jsx)(MoveItem,{...n[1],moveIdx:(t-1)*2+2})]})}function MovesPanel(){let e=(0,o.Dv)(d),n=(0,o.Dv)(c),t=(0,w.useMemo)(()=>{let t=e.history();if(!t.length)return;let i=[];for(let e=0;e<t.length;e+=2){var a,o;let r=[{san:t[e],moveClassification:null==n?void 0:null===(a=n.positions[e+1])||void 0===a?void 0:a.moveClassification}];t[e+1]&&r.push({san:t[e+1],moveClassification:null==n?void 0:null===(o=n.positions[e+2])||void 0===o?void 0:o.moveClassification}),i.push(r)}return i},[e,n]);return(0,i.jsx)(k.ZP,{container:!0,item:!0,justifyContent:"center",alignItems:"start",gap:.8,sx:{scrollbarWidth:"thin",overflowY:"auto"},maxHeight:"100%",xs:6,id:"moves-panel",children:null==t?void 0:t.map((e,n)=>(0,i.jsx)(MovesLine,{moves:e,moveNb:n+1},"".concat(e.map(e=>{let{san:n}=e;return n}).join(),"-").concat(n)))})}function ClassificationRow(e){let{classification:n}=e,t=(0,o.Dv)(c),l=(0,o.Dv)(h),s=(0,o.Dv)(d),{goToMove:u}=(0,a.f)(h),m=(0,w.useMemo)(()=>t?t.positions.filter((e,t)=>t%2!=0&&e.moveClassification===n).length:0,[t,n]),v=(0,w.useMemo)(()=>t?t.positions.filter((e,t)=>t%2==0&&e.moveClassification===n).length:0,[t,n]),handleClick=e=>{if(!t||e===r.Il.White&&!m||e===r.Il.Black&&!v)return;let filterColor=n=>n%2!=0&&e===r.Il.White||n%2==0&&e===r.Il.Black,i=l.history().length,a=t.positions.findIndex((e,t)=>filterColor(t)&&e.moveClassification===n&&t>i);if(a>0)u(a,s);else{let e=t.positions.findIndex((e,t)=>filterColor(t)&&e.moveClassification===n);e>0&&e!==i&&u(e,s)}};return(0,i.jsxs)(k.ZP,{container:!0,item:!0,justifyContent:"space-evenly",alignItems:"center",xs:12,wrap:"nowrap",color:el.h[n],children:[(0,i.jsx)(k.ZP,{container:!0,item:!0,justifyContent:"center",alignItems:"center",width:"3rem",style:{cursor:m?"pointer":"default"},onClick:()=>handleClick(r.Il.White),fontSize:"0.9rem",children:m}),(0,i.jsxs)(k.ZP,{container:!0,item:!0,justifyContent:"start",alignItems:"center",width:"7rem",gap:1,wrap:"nowrap",children:[(0,i.jsx)(ec(),{src:"/icons/".concat(n,".png"),alt:"move-icon",width:18,height:18,style:{maxWidth:"3.5vw",maxHeight:"3.5vw"}}),(0,i.jsx)(I.Z,{align:"center",fontSize:"0.9rem",children:(0,ed.kC)(n)})]}),(0,i.jsx)(k.ZP,{container:!0,item:!0,justifyContent:"center",alignItems:"center",width:"3rem",style:{cursor:v?"pointer":"default"},onClick:()=>handleClick(r.Il.Black),fontSize:"0.9rem",children:v})]})}function MovesClassificationsRecap(){let{whiteName:e,blackName:n}=usePlayersNames(d),t=(0,o.Dv)(c);return(null==t?void 0:t.positions.length)?(0,i.jsxs)(k.ZP,{container:!0,item:!0,justifyContent:"center",alignItems:"center",rowGap:1,xs:6,sx:{scrollbarWidth:"thin",overflowY:"auto"},maxHeight:"100%",children:[(0,i.jsxs)(k.ZP,{item:!0,container:!0,alignItems:"center",justifyContent:"space-evenly",wrap:"nowrap",xs:12,children:[(0,i.jsx)(I.Z,{width:"12rem",align:"center",noWrap:!0,fontSize:"0.9rem",children:e}),(0,i.jsx)(I.Z,{width:"7rem"}),(0,i.jsx)(I.Z,{width:"12rem",align:"center",noWrap:!0,fontSize:"0.9rem",children:n})]}),eu.map(e=>(0,i.jsx)(ClassificationRow,{classification:e},e))]}):null}let eu=[r.ZJ.Brilliant,r.ZJ.Great,r.ZJ.Best,r.ZJ.Excellent,r.ZJ.Good,r.ZJ.Book,r.ZJ.Inaccuracy,r.ZJ.Mistake,r.ZJ.Blunder];function ClassificationPanel(){let e=(0,o.Dv)(d);return e.history().length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(er.Z,{sx:{marginX:"5%"}}),(0,i.jsxs)(k.ZP,{container:!0,item:!0,justifyContent:"center",alignItems:"start",height:"100%",minHeight:{lg:"50px",xs:void 0},sx:{overflow:"hidden"},children:[(0,i.jsx)(MovesPanel,{}),(0,i.jsx)(MovesClassificationsRecap,{})]})]}):null}function GameReport(){let e=(0,ea.Z)(),n=(0,eo.Z)(e.breakpoints.up("lg")),{reset:t}=(0,a.f)(h),{setPgn:r}=(0,a.f)(d),[s,u]=(0,o.KO)(c),v=(0,o.b9)(m),g=(0,ee.useRouter)(),{gameId:x}=g.query;return(0,w.useEffect)(()=>{x||(t(),u(void 0),v(!0),r(new l.qQ().pgn()))},[x,u,v,t,r]),(0,i.jsxs)(k.ZP,{container:!0,gap:4,justifyContent:"space-evenly",alignItems:"center",children:[(0,i.jsx)(BoardContainer,{}),(0,i.jsx)(k.ZP,{container:!0,item:!0,borderRadius:2,border:1,borderColor:"secondary.main",xs:12,lg:!0,sx:{backgroundColor:"secondary.main",borderColor:"primary.main",borderWidth:2,boxShadow:"0 2px 10px rgba(0, 0, 0, 0.5)"},padding:2.5,style:{maxWidth:"1200px"},display:"grid",children:(0,i.jsx)(k.ZP,{container:!0,item:!0,justifyContent:"center",alignItems:"center",xs:12,rowGap:2,maxHeight:{lg:"calc(95vh - 130px)",xs:"900px"},display:"grid",gridTemplateRows:"repeat(4, auto) fit-content(100%)",children:n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ReviewPanelHeader,{},"analysis-panel-header"),(0,i.jsx)(er.Z,{sx:{marginX:"5%"}}),(0,i.jsx)(ReviewPanelBody,{},"review-panel-body"),(0,i.jsx)(ClassificationPanel,{},"review-panel-class"),(0,i.jsx)(er.Z,{sx:{marginX:"5%"}}),(0,i.jsx)(ReviewPanelToolBar,{},"review-panel-toolbar")]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ReviewPanelToolBar,{},"review-panel-toolbar"),(0,i.jsx)(er.Z,{sx:{marginX:"5%"}}),!s&&(0,i.jsx)(ReviewPanelHeader,{},"analysis-panel-header"),!s&&(0,i.jsx)(er.Z,{sx:{marginX:"5%"}}),(0,i.jsx)(ReviewPanelBody,{},"review-panel-body"),(0,i.jsx)(ClassificationPanel,{},"review-panel-class"),s&&(0,i.jsx)(er.Z,{sx:{marginX:"5%"}}),s&&(0,i.jsx)(ReviewPanelHeader,{},"analysis-panel-header")]})})})]})}},1873:function(e,n,t){"use strict";t.d(n,{Z:function(){return LoadGameButton}});var i=t(5893),a=t(5662),o=t(7294),r=t(7697),l=t(5366),s=t(9983),c=t(657),d=t(7645),h=t(6514),u=t(6886),m=t(4054),v=t(3841),g=t(5945),x=t(7709),p=t(8972),j=t(5861),f=t(1425),y=t(1903);function GamePgnInput(e){let{pgn:n,setPgn:t}=e;return(0,i.jsx)(m.Z,{sx:{m:1,width:600},children:(0,i.jsx)(y.Z,{label:"Enter PGN here...",variant:"outlined",multiline:!0,value:n,onChange:e=>t(e.target.value)})})}var w=t(1645),Z=t(4661);let getChessComUserRecentGames=async e=>{var n,t;let i=new Date,a=i.getUTCFullYear(),o=i.getUTCMonth()+1,r=(0,Z.hd)(o),l=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(a,"/").concat(r));if(404===l.status)return[];let s=await l.json(),c=null!==(n=null==s?void 0:s.games)&&void 0!==n?n:[];if(c.length<50){let n=1===o?12:o-1,i=(0,Z.hd)(n),r=12===n?a-1:a,l=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(r,"/").concat(i)),s=await l.json();c.push(...null!==(t=null==s?void 0:s.games)&&void 0!==t?t:[])}let d=c.sort((e,n)=>n.end_time-e.end_time).slice(0,50);return d};var C=t(8619),b=t(9334),P=t(8456);function ChessComInput(e){let{pgn:n,setPgn:t}=e,[a,r]=(0,o.useState)(0),[l,s]=(0,w._)("chesscom-username",""),[c,d]=(0,o.useState)([]);return(0,o.useEffect)(()=>{if(!l){d([]);return}let e=setTimeout(async()=>{let e=await getChessComUserRecentGames(l);d(e)},0===a?0:500);return r(e=>e+1),()=>{clearTimeout(e)}},[l]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(m.Z,{sx:{m:1,width:300},children:(0,i.jsx)(y.Z,{label:"Enter your Chess.com username...",variant:"outlined",value:null!=l?l:"",onChange:e=>s(e.target.value)})}),l&&(0,i.jsxs)(u.ZP,{container:!0,item:!0,xs:12,gap:2,justifyContent:"center",alignContent:"center",minHeight:100,children:[c.map(e=>(0,i.jsx)(C.Z,{onClick:()=>t(e.pgn),selected:n===e.pgn,style:{width:350,maxWidth:350},children:(0,i.jsx)(b.Z,{primary:"".concat((0,Z.kC)(e.white.username)||"White"," (").concat(e.white.rating||"?",") vs ").concat((0,Z.kC)(e.black.username)||"Black"," (").concat(e.black.rating||"?",")"),secondary:"".concat((0,Z.kC)(e.time_class)," played at ").concat(new Date(1e3*e.end_time).toLocaleString().slice(0,-3)),primaryTypographyProps:{noWrap:!0},secondaryTypographyProps:{noWrap:!0}})},e.uuid)),0===c.length&&(0,i.jsx)(P.Z,{})]})]})}var k=t(8835);function LichessInput(e){let{pgn:n,setPgn:t}=e,[a,r]=(0,o.useState)(0),[l,s]=(0,w._)("lichess-username",""),[c,d]=(0,o.useState)([]);return(0,o.useEffect)(()=>{if(!l){d([]);return}let e=setTimeout(async()=>{let e=await (0,k.M)(l);d(e)},0===a?0:500);return r(e=>e+1),()=>{clearTimeout(e)}},[l]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(m.Z,{sx:{m:1,width:300},children:(0,i.jsx)(y.Z,{label:"Enter your Lichess username...",variant:"outlined",value:null!=l?l:"",onChange:e=>s(e.target.value)})}),l&&(0,i.jsxs)(u.ZP,{container:!0,item:!0,xs:12,gap:2,justifyContent:"center",alignContent:"center",minHeight:100,children:[c.map(e=>{var a,o,r,l,s,c;return(0,i.jsx)(C.Z,{onClick:()=>t(e.pgn),selected:n===e.pgn,style:{width:350,maxWidth:350},children:(0,i.jsx)(b.Z,{primary:"".concat((0,Z.kC)((null===(a=e.players.white.user)||void 0===a?void 0:a.name)||"white")||"White"," (").concat((null===(r=e.players)||void 0===r?void 0:null===(o=r.white)||void 0===o?void 0:o.rating)||"?",") vs ").concat((0,Z.kC)((null===(l=e.players.black.user)||void 0===l?void 0:l.name)||"black")||"Black"," (").concat((null===(c=e.players)||void 0===c?void 0:null===(s=c.black)||void 0===s?void 0:s.rating)||"?",")"),secondary:"".concat((0,Z.kC)(e.speed)," played at ").concat(new Date(e.lastMoveAt).toLocaleString().slice(0,-3)),primaryTypographyProps:{noWrap:!0},secondaryTypographyProps:{noWrap:!0}})},e.id)}),0===c.length&&(0,i.jsx)(P.Z,{})]})]})}function NewGameDialog(e){let{open:n,onClose:t,setGame:y}=e,[Z,C]=(0,o.useState)(""),[b,P]=(0,w._)("preferred-game-origin",s.iR.Pgn),[k,E]=(0,o.useState)(""),{addGame:D}=(0,r.f)(),handleClose=()=>{C(""),E(""),t()};return(0,i.jsxs)(c.Z,{open:n,onClose:handleClose,maxWidth:"md",fullWidth:!0,children:[(0,i.jsx)(d.Z,{marginY:1,variant:"h5",children:y?"Load a game":"Add a game to your database"}),(0,i.jsx)(h.Z,{children:(0,i.jsxs)(u.ZP,{container:!0,marginTop:1,alignItems:"center",justifyContent:"start",rowGap:2,children:[(0,i.jsxs)(m.Z,{sx:{m:1,width:150},children:[(0,i.jsx)(v.Z,{id:"dialog-select-label",children:"Game origin"}),(0,i.jsx)(g.Z,{labelId:"dialog-select-label",id:"dialog-select",displayEmpty:!0,input:(0,i.jsx)(x.Z,{label:"Game origin"}),value:null!=b?b:"",onChange:e=>P(e.target.value),children:Object.values(s.iR).map(e=>(0,i.jsx)(p.Z,{value:e,children:I[e]},e))})]}),b===s.iR.Pgn&&(0,i.jsx)(GamePgnInput,{pgn:Z,setPgn:C}),b===s.iR.ChessCom&&(0,i.jsx)(ChessComInput,{pgn:Z,setPgn:C}),b===s.iR.Lichess&&(0,i.jsx)(LichessInput,{pgn:Z,setPgn:C}),k&&(0,i.jsx)(m.Z,{fullWidth:!0,children:(0,i.jsx)(j.Z,{color:"red",textAlign:"center",marginTop:1,children:k})})]})}),(0,i.jsxs)(f.Z,{sx:{m:2},children:[(0,i.jsx)(a.Z,{variant:"outlined",sx:{marginRight:2},onClick:handleClose,children:"Cancel"}),(0,i.jsx)(a.Z,{variant:"contained",onClick:()=>{if(Z){E("");try{let e=(0,l.pe)(Z);y?y(e):D(e),handleClose()}catch(e){console.error(e),E(e instanceof Error?"".concat(e.message," !"):"Unknown error while parsing PGN !")}}},children:"Add"})]})]})}let I={[s.iR.Pgn]:"PGN",[s.iR.ChessCom]:"Chess.com",[s.iR.Lichess]:"Lichess.org"};function LoadGameButton(e){let{setGame:n,label:t,size:r}=e,[l,s]=(0,o.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.Z,{variant:"contained",onClick:()=>s(!0),size:r,children:t||"Add game"}),(0,i.jsx)(NewGameDialog,{open:l,onClose:()=>s(!1),setGame:n})]})}}},function(e){e.O(0,[546,982,192,76,302,381,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);